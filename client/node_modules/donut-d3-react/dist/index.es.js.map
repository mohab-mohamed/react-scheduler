{"version":3,"file":"index.es.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport * as d3 from \"d3\";\n\nimport \"./styles.css\";\n\nexport default class Donut extends Component {\n  static propTypes = {\n    data: PropTypes.array.isRequired, //data: [ {value: number, title: string}, ... ]\n\n    colorScale: PropTypes.func,\n    onArcMouseOverHandler: PropTypes.func,\n    onArcMouseOutHandler: PropTypes.func,\n    onArcClickHandler: PropTypes.func,\n    maxDiameter: PropTypes.number,\n    outerToInnerRadiiRatio: PropTypes.number,\n    showKey: PropTypes.bool,\n    keyTextOffsetX: PropTypes.number,\n    keyTextOffsetY: PropTypes.number,\n    keyFontSize: PropTypes.number,\n    keyRowSeparation: PropTypes.number,\n    keyRectSize: PropTypes.number,\n  }\n\n  static defaultProps = {\n    colorScale: d3.scaleOrdinal(d3.schemeCategory10),\n    onArcMouseOverHandler: function(e, d) {},\n    onArcMouseOutHandler:  function(e, d) {},\n    onArcClickHandler:  function(e, d) {},\n    maxDiameter: 500,\n    outerToInnerRadiiRatio: 2,\n    showKey: true,\n    keyTextOffsetX: 20,\n    keyTextOffsetY: 14,\n    keyFontSize: 16,\n    keyRowSeparation: 20,\n    keyRectSize: 16,\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      width: 500,\n      value: \"\",\n      title: \"\",\n      percentage: \"\",\n    };\n\n    this.donut = React.createRef();\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.resize); //add resize listener for responsiveness\n\n    this.resize(); //initial resize\n  }\n\n  resize = () => {\n    if(this.donut.current) {\n      this.setState({\n        width: this.donut.current.clientWidth, //responsive chart width\n      });\n    }\n  }\n\n  mouseoverArc = (e, d, total) => {\n    this.setState({\n      value: d.data.value,\n      title: d.data.title,\n      percentage: roundPercentage(d.data.value/total)+\"%\"\n    });\n\n    this.props.onArcMouseOverHandler(e, d)\n  }\n\n  mouseoutArc = e => {\n    this.setState({value: \"\", title: \"\", percentage: \"\"});\n\n    this.props.onArcMouseOutHandler(e)\n  }\n\n\n  renderArc = (d, i, radius, total) => {\n    return (\n      <Arc key={i}\n        outerRadius={radius}\n        innerRadius={radius / this.props.outerToInnerRadiiRatio}\n        d={d}\n        total={total}\n        mouseover={this.mouseoverArc}\n        mouseout={this.mouseoutArc}\n        onclick={this.props.onArcClickHandler}\n        fill={this.props.colorScale(i)}\n      />\n    );\n  }\n\n  renderKey(d, i, total) {\n    return (\n      <g key={i} transform={\"translate(0,\"+(i*this.props.keyRowSeparation)+\")\"}>\n        <rect className=\"key\" fill={this.props.colorScale(i)} x=\"0\" y=\"0\" width={this.props.keyRectSize} height={this.props.keyRectSize}></rect>\n        <text transform={\"translate(\"+this.props.keyTextOffsetX+\",\"+this.props.keyTextOffsetY+\")\"} fontSize={this.props.keyFontSize}>\n        {d.data.title} | {d.data.value} | {roundPercentage(d.data.value/total)+\"%\"}\n        </text>\n      </g>\n    );\n  }\n\n\n  render() {\n    const {data, maxDiameter, showKey, keyRowSeparation} = this.props;\n\n    let diameter = Math.min(this.state.width, maxDiameter);\n\n    let x = this.state.width / 2;\n    let y = diameter / 2;\n\n    let pie = d3.pie().value(d => d.value);\n    let total = data.reduce((a, b) => a + b.value, 0);\n\n    return (\n      <div ref={this.donut}>\n        <svg className=\"donut\" width={this.state.width} height={diameter}>\n          <g transform={`translate(${x}, ${y})`}>\n            {pie(data).map((d, i) => this.renderArc(d, i, diameter/2, total))}\n\n            <g>\n            <text textAnchor=\"middle\" transform={\"translate(0,\"+(diameter/25)+\")\"} style={{fontSize:diameter/12+\"px\"}}>{this.state.percentage}</text>\n              <text textAnchor=\"middle\" transform={\"translate(0,\"+(-2*diameter/25)+\")\"} style={{fontSize:diameter/25+\"px\"}}>{this.state.title}</text>\n              <text textAnchor=\"middle\" transform={\"translate(0,\"+(4*diameter/25)+\")\"} style={{fontSize:diameter/12+\"px\"}}>{typeof this.state.value===\"string\" ? \"\" : roundNumber(this.state.value)}</text>\n            </g>\n          </g>\n        </svg>\n\n        {\n          showKey ?\n          (\n            <svg width={this.state.width} height={data.length*keyRowSeparation}>\n              {pie(this.props.data).map((d, i) => this.renderKey(d, i, total))}\n            </svg>\n          ) :\n          null\n        }\n      </div>\n    );\n  }\n}\n\n\nclass Arc extends Component {\n  render() {\n    const {d, fill, total, innerRadius , outerRadius} = this.props;\n\n    let arc = d3.arc().innerRadius(innerRadius).outerRadius(outerRadius);\n\n    return (\n      <path className=\"arc\" d={arc(d)} fill={fill} onClick={e => this.props.onclick(e, d)} onMouseOver={e => this.props.mouseover(e, d, this.props.total)} onMouseOut={e => this.props.mouseout(e)}>\n        <title>{d.data.title} - {d.value} - {roundPercentage(d.value/total)}%</title>\n      </path>\n    );\n  }\n}\n\nfunction roundNumber(number) {\n  return Math.round(100*number)/100;\n}\n\nfunction roundPercentage(number) {\n  return Math.round(10000*number)/100;\n}\n"],"names":["Donut","props","resize","donut","current","setState","clientWidth","mouseoverArc","e","d","total","data","value","title","roundPercentage","onArcMouseOverHandler","mouseoutArc","percentage","onArcMouseOutHandler","renderArc","i","radius","outerToInnerRadiiRatio","onArcClickHandler","colorScale","state","React","createRef","addEventListener","keyRowSeparation","keyRectSize","keyTextOffsetX","keyTextOffsetY","keyFontSize","maxDiameter","showKey","diameter","Math","min","width","x","y","pie","d3","reduce","a","b","map","fontSize","roundNumber","length","renderKey","Component","propTypes","PropTypes","array","isRequired","func","number","bool","defaultProps","Arc","fill","innerRadius","outerRadius","arc","onclick","mouseover","mouseout","round"],"mappings":"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"}